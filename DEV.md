# ⚡Spider_DCD⚡

汽车大模型项目代码，陈果自留。

### 😈7.12日志

这一次上传中，有两个程序，一个dcd.py,这个程序可以把参数页面中的数据爬成csv，也能对多值属性进行处理，基本上完成了任务。

不过，这个程序中还是有bug，比如检索的条件可能会导致页面中的某些属性没法被抓到，跟他的标签有关，目前看好像是索引，但是我懒得搞了，毕竟是少数。

如果可以接受几千条数据中有少数几条不太对劲，似乎这个结果也还算OK。跑出来第一辆车的数据，“基本”没啥问题。

好吧，因为本人目前在实习，又懒又没时间，跑出来的数据只跑了一辆车，希望有人看到我的日志，能帮我测试一下这个程序，看看哪里有问题，如果能解决最好了。

第二个程序dcd0.py,这个程序因为我暂时没空，我还没有跑，添加了遍历完当前页面的所有卡片之后向下滚动，直到渲染出新卡片的逻辑。待测试。

### 😠7.15日志

这一次上传中新增了汽车之家口碑数据的爬虫，不过大失败。

qczj.py是异步编程的版本，qczj1.py是同步编程的版本，目前我正在调试1这个版本。记录几个问题。

1. 进入卡片页面后，这里可能会弹出一个弹窗，如果是人手操作，点击旁边的空白区域即可关闭，但是playwright就是关不掉。
2. 点击这个口碑按钮的操作，死活完成不了，我写的xpath应该是正确的，现在改用CSS选择器，也点不到。
3. 由于口碑按钮一直进不去，后面编写的程序一直无法测试。不过，写的几个xpath表达式应该都是对的，这个网站的评价页dom还是挺友好的。

昨晚酩酊大醉，精神状态不佳，所以今天早上有点不想接着做了。日后继续debug...

下午：更换了一部分爬虫逻辑，现在弹窗检测和口碑按钮都能点到了。但是进去之后，“查看完整口碑”这个按钮找不到，也就没反应了。

初步的计划是，先搁置这一块点击的逻辑。现在留下的几个程序，autohome.py是我计划的最终程序，现在卡在如何遍历每一辆车的每一条评价。也就是刚才说的“查看完整口碑”。autohome-in.py这个程序以完整口碑点击后的页面作为起始页，经过测试，已经能非常完善的爬到需要的数据了。下一步操作，要把遍历的逻辑搞好，然后把-in这个程序拉进去，数据就算是到手了。

傍晚：程序似乎已经调好了，只是没有测试。autohome.py就是最终程序，之前可参考的半成品我都放到了beta里面。

### 😣7.16日志

添加了Docker化的用法。

另外，如果需要同步分支：
```
git checkout -b develop
git branch --set-upstream-to=origin/develop develop
git pull
```

beta中添加了一个带滚动逻辑的autohome_scroll.py,即当前页面的卡片都遍历完后，向下滚动渲染新的卡片，但是所需时间太长，还未测试。

### 🥱7.17日志

进行了第一个版本的迭代。dcd_v0.0.1中，最后几个数据项在dom tree中的属性不同所以没有抓到。在dcd_v0.0.2中，修改了检索逻辑，现在已经可以正确的捕获页面中的所有元素了。不过，第一行出现异常数据的问题还是没有解决。

在dcd_v0.0.3中，修改了nest部分的处理逻辑，现在已经可以解决第一行多值异常的问题了。

添加了clear.py，运行可以自动清除本地数据文件夹的内容。

至此，如果没有出现新问题，两个爬虫的大框架就已经写完了。下一步计划是滚动测试，以及header伪装。添加了pytest脚本，仍在调试中。

在dcd_v0.0.4和autohome_v0.0.2中，都添加了http header伪装，提升安全性。

### 😓7.18日志

dcd_v0.0.5中，添加了滚动逻辑，但是保存的csv文件是按照型号的，每个型号一个文件。

dcd_v0.0.6中，我按照card外面的车名进行保存。

下一步的开发工作，可以参考dcd_v0.0.6，把相同的滚动逻辑和保存形式搬到汽车之家的程序中。当然，最好能模仿这个文件名保存的形式并在后面加上_评价，这样方便检索。

汽车之家的v0.0.3版本我已经添加了滚动逻辑，但是这个需要很长的测试时间，我还没测试完。

为了提升效率，我几乎去除了所有wait_for_load_state("networkidle")后面的sleep。如果日后出现了问题，仍然要加回去。目前的版本，汽车之家0.0.3，懂车帝0.0.6，如果需要参考，可以参考它们的前一个版本。

### 😫7.23日志

autohome_v0.0.4中，新增了一个出错时截图的功能，不过目前被我注释了。

新增了字段检索的处理，如果与csv中字段相比更多，则忽略多的部分；如果更少，就把缺少的部分填成空。这样，可以提升一些效率，也能减少些错误。